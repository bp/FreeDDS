<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Data Dictionary System: Code Slinger Other Example Codes</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <meta name="keywords" 
      content="Data Dictionary System Free Seismic Processing System">
    <link href="../../styles.css" type="text/css" rel="stylesheet">
    <script src="../../javascript.js" language="JavaScript"
      type="text/javascript"></script>
    </script>
    <style type="text/css">
      pre {color:#000000;}
    </style>
  </head>
  <body>

    <script type="text/javascript">
      header("codeslinger","basiccodes","timers")
    </script>
    <!*********************************************************************>

<pre>
!**********************************************************************
! Copyright 2010, Allied Geophysics, Inc.
! All Rights Reserved
!**********************************************************************
!
! Start timers or get elapsed time from reference times established
! in a prior call to timers()
!
! Calling with neative reference times causes the current time to be
!   returned in wt_elapsed and ct_elapsed.
!
! Calling with non negative reference times causes elapsed times to be
!   measured relative to reference times.
!
! Calling with ireset.eq.1 will reset reference times to curehrent time.
!
! Calling with ireset.eq.0 leaves reference times unchanged.
!
! Arguments:
!  real*8  wt_ref      inout  reference wall time
!  real*8  ct_ref      inout  reference CPU  time
!  real*8  wt_elapsed  out    wall time elapsed since reference
!  real*8  ct_elapsed  out    CPU  time elapsed since reference
!  integer ireset      in     reference time reset flag (.eq.1 to reset)
!
! Bugs:
!  Subroutine cpu_time() is allowed to return negative values if a
!    meaningful value cannot be determined. Those are kludged to set
!    ct_elapsed=0.0.
!
!  If max_tick is passed more than once between calls, the extra
!    iterations through max_tick clock ticks are not accumulated.
!
!**********************************************************************

      subroutine timers(wt_ref,ct_ref, wt_elapsed,ct_elapsed, ireset)

      implicit none

      integer,parameter :: DP=selected_real_kind(15,300)

! Arguments
      real(KIND=DP),intent(inout) :: wt_ref,ct_ref
      real(KIND=DP),intent(out)   :: wt_elapsed,ct_elapsed
      integer                     :: ireset

! Locals
      integer tick,tick_rate,tick_max
      real(KIND=DP) :: max_time, wt_newref,ct_newref
      real(KIND=DP) :: wt_here,ct_here

!-----------------------------------------------------------------------
! Done with declarations
!-----------------------------------------------------------------------

      call cpu_time(ct_here)
      call system_clock(tick,tick_rate,tick_max)
      wt_here = dble(tick)/dble(tick_rate)

      if (wt_ref.ge.0) then
        if (wt_here-wt_ref.ge.0.0) then
          wt_elapsed = wt_here-wt_ref
        else
          max_time = dble(tick_max)/dble(tick_rate)
          wt_elapsed = max_time - wt_ref + wt_here
        endif
      endif

      if (ct_ref.ge.0.0) then
        ct_elapsed = ct_here - ct_ref
      else
        if (ct_elapsed.lt.0.0) ct_elapsed=0.0
      endif

      if (ireset.eq.1) then
        wt_ref=wt_here
        ct_ref=ct_here
      endif

      return
      end
</pre>
  
    <!*********************************************************************>
    <script type="text/javascript">footer()</script>
  </body>
</html>
