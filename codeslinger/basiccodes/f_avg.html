<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Data Dictionary System: Code Slinger Examples (access samples)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <meta name="keywords" 
      content="Data Dictionary System Free Seismic Processing System">
    <link href="../../styles.css" type="text/css" rel="stylesheet">
    <script src="../../javascript.js" language="JavaScript"
      type="text/javascript"></script>
    </script>
    <style type="text/css">
      pre {color:#000000;}
    </style>
  </head>
  <body>

    <script type="text/javascript">
      header("codeslinger","basiccodes","f_avg.F")
    </script>
    <!*********************************************************************>

<pre>
c***********************************************************************
c
c Get the average value of a dataset
c
c***********************************************************************

      program f_avg

      implicit none

#include &lt;<a href="../resources/fdds.h.html">fdds.h</a>&gt;

c For DDS functions. Arguments and return values
      character prog*(5), Title*(80)
      integer   ier, fd_in

c Data attributes
      integer n1,n2,n3

c Internal dynamic array
      real    trace(1)
      pointer (ptr_trace,trace)

c Internal scalar values and loop counters
      integer i2,i3
      real    data_avg
      double precision data_sum, denom

c-------------------------------------------------------------------
c
c Initialize the Title
c
      prog='f_avg'
      Title=prog//': Get the average value of a dataset'

c
c Open input file
c
      fd_in=<a href="../fapishort/fddx_in.html">fddx_in</a>('in','stdin:',Title)

c
c Retrieve data characteristics
c
      ier=<a href="../fapishort/fdds_scanf.html">fdds_scanf</a>('size.axis(1)','%d\0',n1)
      ier=<a href="../fapishort/fdds_scanf.html">fdds_scanf</a>('size.axis(2)','%d\0',n2)
      n3=<a href="../fapishort/fdds_axis_prod.html">fdds_axis_prod</a>(3)

c
c Allocate array
c
      ptr_trace=<a href="../fapishort/fdds_malloc8.html">fdds_malloc8</a>(dble(n1*SIZEOF_REAL))

c
c Initialize the sum
c
      data_sum=0.0

c
c Loop over input data, accumulating the sum
c
      do i3 = 1,n3
         do i2 = 1,n2
            ier=<a href="../fapishort/fddx_read.html">fddx_read</a>(fd_in,trace,1)
            call accumulate_sum(trace, n1, data_sum)
         enddo
      enddo

c
c Compute the average
c
      denom = dble(n1)*dble(n2)*dble(n3)
      data_avg = data_sum/denom

c
c Report the result
c
      write(0,*) 'The average of input samples is',data_avg

c
c Clean up
c
      ier=<a href="../fapishort/fdds_free.html">fdds_free</a>(ptr_trace)
      ier=<a href="../fapishort/fdds_close.html">fdds_close</a>(fd_in)

c
c Stop
c
      stop
      end




c***********************************************************************
c
c accumulate the sum of data samples
c
c***********************************************************************

      subroutine accumulate_sum(data_in, n_in, data_sum)

      implicit none

c Arguments
      integer n_in
      real    data_in(n_in)
      double precision data_sum

c Locals
      integer i

c Accumulate the sum
      do i = 1, n_in
         data_sum=data_sum+data_in(i)
      enddo

      return
      end
</pre>
  
    <!*********************************************************************>
    <script type="text/javascript">footer()</script>
  </body>
</html>
