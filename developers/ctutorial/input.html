<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Data Dictionary System: Developers "C" Tutorial (Input)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <meta name="keywords" 
      content="Data Dictionary System Free Seismic Processing System">
    <link href="../../styles.css" type="text/css" rel="stylesheet">
    <script src="../../javascript.js" language="JavaScript"
      type="text/javascript"></script>
  </head>
  <body>
    <script type="text/javascript">
      header("developers","ctutorial","input")
    </script>
    <!*********************************************************************>

    <h2>Open External Input Dataset</h2>

    <p>
      <a href="../capi/in.html">cdds_in</a> is called to initialize an
      input dictionary. A temporary dictionary name is returned, along with
      any dictionaries specified by the user/default. It provides the title
      and a copy of the bootstrap dictionaries (par:). The resulting 
      dictionaries are left in "scan" mode.

    <p>
      This is normally followed by a call to  
      <a href="../capi/open.html">cdds_open</a> to open the binary stream
      associated with the dictionary.

    <pre>
in_dict = <a href="../capi/in.html">cdds_in</a>("in", "stdin:", title);
in_bin = <a href="../capi/open.html">cdds_open</a>(in_dict, "in_format", "in_data", "r");
if (in_bin &lt; 0) {
   cdds_prterr("Unable to open input data\n");
}

cdds_scanf("size.axis(1)", "%d", &amp;ns);
    </pre>

    <p>
      Another example is to open a velocity file with no default.

    <pre>
vel_dict = <a href="../capi/in.html">cdds_in</a>("vel", " ", title);
vel_bin = <a href="../capi/open.html">cdds_open</a>(vel_dict, "vel_format", "vel_data", "r");
    </pre>

    <! -------------------------------------------------------------------->
    <hr/>
    <h2>Open Internal Buffer</h2>

    <p>
      A dataset may not be in a host-dependent format with which a program 
      can work.  So an internal buffer binary must be defined and opened.
      This is done creating a temporary internal buffer dictionary and
      defining the desired fields in a host-dependent format (typically
      "<b>asp</b>" and then opening the binary stream.  You can write
      modification definitions to the "<b>override:</b>" internal 
      dictionary via the "<b>MOD_FIELD</b>" definition.
      (See <a href="process.html">Process Data</a> to see how to map the 
      input buffer to this internal buffer.)

    <pre>
/* "override:" overrides any existing definitions. */
<a href="../capi/dict.html">cdds_dict</a>("override:", "print");

<a href="../capi/printf.html">cdds_printf</a>("MOD_FIELD", "*+ int StaCor;\n");
<a href="../capi/printf.html">cdds_printf</a>(" ", "*+ float SrcX;\n");
<a href="../capi/printf.html">cdds_printf</a>(" ", "*+ SAMPLE_TYPE Samples[axis_size(1)];\n");

<a href="../capi/printf.html">cdds_printf</a>("fmt:*:asp.SAMPLE_TYPE", 
          "typedef float SAMPLE_TYPE;\n");
    </pre>
      
    <p>
      The application can open binary data using this internal "<b>asp</b>" 
      format. The open <i>mode</i> is "<b>m</b>" (memory), because external
      I/O to a stream is not required.  The data will only reside within
      buffers provided by the application (buf) or by cdds_write.

    <pre>
int buf_bin;
const char *buf_dict;
...
/* Initialize "buf_dict" dictionary */
buf_dict = <a href="../capi/out.html">cdds_out</a>(" ", " ", in_dict);
<a href="../capi/printf.html">cdds_printf</a>("buf_format", " asp\n");
            
/* Open "buf" binary (see "override:") */
buf_bin = <a href="../capi/open.html">cdds_open</a>(buf_dict, "buf_format", " ", "m");

/* close out the override: dictionary */
<a href="../capi/dict.html">cdds_dict</a>("override:", "reset");

    </pre>

    <! -------------------------------------------------------------------->
    <hr/>
    <h2>Access Internal Buffer Fields</h2>

    <p>
      There are several ways to access fields within the internal buffer.

    <ul>
      <li>Retrieve the index to a specific field:
        <pre>
int tag, sxindex, smpindex;
float srcx, *buf;
...
tag = <a href="../capi/member.html">cdds_member</a>(buf_bin, 0, "SrcX");
sxindex = <a href="../capi/index.html">cdds_index</a>(buf_bin, tag, DDS_FLOAT);
tag = <a href="../capi/member.html">cdds_member</a>(buf_bin, 0, "Samples");
smpindex = <a href="../capi/index.html">cdds_index</a>(buf_bin, tag, DDS_FLOAT);
...
srcx = buf[sxindex];
process(buf[smpindex), ...);
...
buf[sxindex] = srcx;
        </pre>

      <li>Rerieve the field value by tag:
        <pre>
stacortag = <a href="../capi/member.html">cdds_member</a>(buf_bin, 0, "StaCor");
...
<a href="../capi/get.html">cdds_geti</a>(buf_bin, stacortag, buf, 0, stacor, 1);
        </pre>
    </ul>

    <!*********************************************************************>
    <script type="text/javascript">footer()</script>
  </body>
</html>
